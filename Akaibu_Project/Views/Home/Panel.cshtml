@{
    ViewData["Title"] = "Panel";
    var panelData = ViewBag.PanelData;
    var loggedUser = ViewContext.HttpContext.Session.GetObject<Akaibu_Project.Entions.Users>("LoggedUser");
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Panel</title>
    <link rel="stylesheet" type="text/css" href="~/css/paneladmin.css">
</head>
<body>

    <h2>Welcome to the Admin Panel</h2>
    <p>Raports:</p>
    <table border="1">
        <thead>
            <tr>
                <th class="custom-header">Report Text</th>
                <th class="custom-header">Date Added</th>
                <th class="custom-header">From User</th>
                <th class="custom-header">Targeted User</th>
                <th class="custom-header">Comment Text</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var report in panelData.Reports)
            {
                <tr>
                    <td class="scrollable">@report.ReportText</td>
                    <td>@report.DateTheReportWasAdded</td>
                    <td>
                        @{
                            var user = ((IEnumerable<dynamic>)panelData.Users).FirstOrDefault(u => u.Id == report.UsersId);
                            var userName = (user != null) ? user.Nick : "Brak użytkownika";
                            @userName
                        }
                    </td>
                    <td>@report.UserNick</td>
                    <td class="scrollable">@report.CommentText</td>
                </tr>
            }
        </tbody>
    </table>
    <p>Sumaryczna ilość raportów: @panelData.Reports.Count</p>
    <br>
    <p>Users:</p>
    <table>
        <thead>
            <tr>
                <th class="custom-header">User ID</th>
                <th class="custom-header">Nick</th>
                <th class="custom-header">Login</th>
                <th class="custom-header">Rank</th>
                <th class="custom-header">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in panelData.Users)
            {
                <tr>
                    <td>@user.Id</td>
                    <td>@user.Nick</td>
                    <td>@user.Login</td>
                    <td>@user.Ranks</td>
                    <td>
                        @if (user.Id != loggedUser.Id)
                        {
                            @if (user.Ranks == 69)
                            {
                                <form method="post" action="@Url.Action("UnbanUser", "Home", new { userId = user.Id })">
                                    <button type="submit" class="unban-button">Unban</button>
                                </form>
                            }
                            else
                            {
                                <form method="post" action="@Url.Action("BanReason", "Home", new { userId = user.Id })">
                                    <button type="submit" class="ban-button">Ban</button>
                                </form>
                            }
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <p>Sumaryczna ilość użytkowników: @panelData.Users.Count</p>
    <br>
</body>
</html>
